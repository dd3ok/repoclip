<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repoclip - Convert Your Git Repository or ZIP to a Clipboard</title>
    <link rel="stylesheet" href="/static/index.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1><a id="home-link" href="/">Repoclip</a></h1>
            <div class="intro">
                <p>📂➡️📄 Github Repository → Clipboard</p>
                <p>🤖💬 LLM 컨텍스트, 코드 분석, 프로젝트 문서화에 사용하세요</p>
            </div>
        </header>

        <main>
            <!-- 분석 방식 선택 탭 -->
            <div class="card">
                <h2>어디서 불러올까요?</h2>
                <div id="analyze-tabs" style="display:flex; gap:0.75rem; margin-bottom:1rem;">
                    <button id="tab-git" class="btn" data-active="true">Repository에서 불러오기</button>
                    <button id="tab-zip" class="btn" data-active="false"
                        style="background-color: var(--secondary-color); color: var(--text-color);">ZIP 파일 업로드</button>
                </div>

                <!-- Git URL 분석 폼 -->
                <form id="analyze-form" style="display:block;">
                    <div class="form-group">
                        <input type="url" id="repo-url-input" placeholder="https://github.com/dd3ok/repo2md" required>
                        <button type="submit" id="analyze-btn" class="btn"><span>불러오기</span></button>
                    </div>
                </form>

                <!-- ZIP 업로드 분석 폼 -->
                <form id="analyze-zip-form" style="display:none;" enctype="multipart/form-data">
                    <div class="form-group">
                        <!-- 숨김 파일 인풋 -->
                        <input type="file" id="repo-zip-input" accept=".zip" required class="file-input-hidden" tabindex="-1">
                        
                        <!-- 파일명 표시용 텍스트 인풋 (Git URL 인풋처럼) -->
                        <input type="text" id="file-name-display" placeholder="ZIP 파일을 선택해주세요" readonly>
                        
                        <!-- 파일 선택 버튼 -->
                        <label for="repo-zip-input" class="btn file-pick-btn">
                            <span>파일 선택</span>
                        </label>
                        
                        <!-- 업로드/분석 버튼 (초기에 비활성화) -->
                        <button type="submit" id="analyze-zip-btn" class="btn" disabled>
                            <span>업로드</span>
                        </button>
                    </div>
                    <div id="zip-progress" style="display:none; margin-top:0.75rem; color: var(--text-light-color);">
                        업로드 중... 잠시만 기다려 주세요.
                    </div>
                </form>


                <div id="error-message"></div>
            </div>

            <!-- 분석 결과 -->
            <div id="analysis-result" class="card">
                <h2>어떤 파일을 내보낼까요?</h2>
                <strong id="repo-name-display"></strong>불러온 파일을 확인하고 내보낼 파일을 선택하세요.

                <div>
                    <h3>파일 확장자</h3>
                    <div style="margin-bottom:0.5rem;">
                        <label><input type="checkbox" id="exts-select-all" checked> 전체 선택</label>
                    </div>
                    <div id="exts-container" class="result-box"></div>
                </div>

                <div>
                    <h3>프로젝트 구조</h3>
                    <div id="tree-container" class="result-box"></div>
                </div>

                <div class="export-buttons">
                    <button id="export-text-btn" class="btn">클립보드에 복사</button>
                    <button id="export-file-btn" class="btn">파일로 내보내기</button>
                </div>
            </div>
        </main>
    </div>

    <!-- 마크다운 미리보기 모달 -->
    <div id="modal-overlay">
        <div id="modal-content">
            <div class="modal-header">
                <h3>클립보드로 내보내기</h3>
                <div class="modal-actions">
                    <span id="page-indicator" style="display:none;"></span>
                    <button id="prev-page" class="btn" style="display:none;">이전</button>
                    <button id="next-page" class="btn" style="display:none;">다음</button>
                    <button id="copy-button" class="btn">클립보드에 복사하기</button>
                    <button id="copy-all-button" class="btn" style="display:none;">전체 복사</button>
                    <button id="modal-close" class="btn">닫기</button>
                </div>
            </div>
            <pre id="markdown-preview"></pre>
        </div>
    </div>

    <footer>
        <p>Created by <a href="https://github.com/dd3ok" target="_blank">dd3ok</a></p>
    </footer>

    <script defer src="/static/index.js"></script>
    <script>
        (function () {
            const tabGit = document.getElementById('tab-git');
            const tabZip = document.getElementById('tab-zip');
            const formGit = document.getElementById('analyze-form');
            const formZip = document.getElementById('analyze-zip-form');

            function activateTab(target) {
                const activeStyle = { bg: 'var(--accent-color)', color: 'var(--bg-color)' };
                const inactiveStyle = { bg: 'var(--secondary-color)', color: 'var(--text-color)' };

                if (target === 'git') {
                    tabGit.style.backgroundColor = activeStyle.bg;
                    tabGit.style.color = activeStyle.color;
                    tabGit.dataset.active = 'true';

                    tabZip.style.backgroundColor = inactiveStyle.bg;
                    tabZip.style.color = inactiveStyle.color;
                    tabZip.dataset.active = 'false';

                    formGit.style.display = 'block';
                    formZip.style.display = 'none';
                } else {
                    tabZip.style.backgroundColor = activeStyle.bg;
                    tabZip.style.color = activeStyle.color;
                    tabZip.dataset.active = 'true';

                    tabGit.style.backgroundColor = inactiveStyle.bg;
                    tabGit.style.color = inactiveStyle.color;
                    tabGit.dataset.active = 'false';

                    formGit.style.display = 'none';
                    formZip.style.display = 'block';
                }
            }

            tabGit.addEventListener('click', () => activateTab('git'));
            tabZip.addEventListener('click', () => activateTab('zip'));
        })();
    </script>
</body>

</html>
